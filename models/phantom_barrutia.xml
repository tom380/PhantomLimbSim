<mujoco model="phantom_barrutia">
    <!-- <option timestep=".0002" integrator="implicitfast" iterations="200" sdf_iterations="40" sdf_initpoints="80" ccd_iterations="100"/> -->
    <option timestep=".0005" integrator="implicit" iterations="200" sdf_iterations="8" sdf_initpoints="32"/>

    <extension>
        <plugin plugin="mujoco.sdf.sdflib">
            <instance name="sdf_thigh">
                <config key="aabb" value="0"/>
            </instance>
            <instance name="sdf_shank">
                <config key="aabb" value="0"/>
            </instance>
        </plugin>
    </extension>

    <compiler angle="radian" strippath="true" meshdir="meshes/Barrutia/"/>

    <visual>
        <map force="0.001"/>
        <scale framelength="0.1" framewidth="0.01"/>
        <global offheight="640"/>
    </visual>

    <asset>
        <texture name="skybox" type="skybox" builtin="flat" rgb1="1 1 1" rgb2="1 1 1" width="512" height="512"/>

        <material name="mat_bones" rgba="0.4 0.4 0.4 1"/>
        <material name="exosuit" rgba="0.4 0.4 0.4 1"/>
        <material name="exosuit_collision" rgba="0.2 0.2 0.2 0"/>

        <mesh file="Hip Fixture.STL" name="hip_fixture"/>
        <mesh file="Femur.STL" name="femur"/>
        <mesh file="Tibia.STL" name="tibia"/>
        <mesh file="Foot.STL" name="foot"/>
        <mesh file="Platform.STL" name="platform"/>
        <mesh file="Thigh.STL" name="thigh"/>
        <mesh file="Shank.STL" name="shank"/>
        <mesh file="ThighStrap.STL" name="thigh_strap"/>
        <mesh file="ShankStrap.STL" name="shank_strap"/>
        <!-- <mesh file="ThighCol.STL" name="thigh_strap_col"/> -->
        <mesh file="ThighStrapCol.obj" name="thigh_strap_col_sdf">
            <plugin instance="sdf_thigh"/>
        </mesh>
        <mesh file="ShankStrapCol.obj" name="shank_strap_col_sdf">
            <plugin instance="sdf_shank"/>
        </mesh>
        <meshfinder>
            <mesh name="ThighCol" alias="thigh_strap_col" split="true"/>
            <mesh name="ShankCol" alias="shank_strap_col" split="true"/>
        </meshfinder>
    </asset>

    <default>
        <default class="bones">
            <joint armature="0.01" limited="false"/>
            <geom margin="0.001" material="mat_bones" conaffinity="0" contype="0"/>
        </default>
        <default class="exosuit">
            <geom conaffinity="0" contype="0" material="exosuit"/>
        </default>
        <default class="exosuit_collision">
            <geom conaffinity="1" contype="1" material="exosuit_collision"/>
        </default>
        <default class="flexbody">
            <joint armature="0" damping="0" limited="false"/>
        </default>
    </default>

    <equality>
        <!-- <weld body1="foot" body2="platform" torquescale="1000" solref="0.004 50000" solimp="0.9 0.95 0.001"/> -->
        <weld body1="foot" body2="platform" torquescale="1000" solref="-100000 -2000" solimp="0.95 0.99 0.0001"/>
        <!-- <weld body1="thigh_band" body2="thigh" torquescale="1000" solref="-100000 -2000" solimp="0.95 0.99 0.0001"/>
        <weld body1="shank_band" body2="shank" torquescale="1000" solref="-100000 -2000" solimp="0.95 0.99 0.0001"/> -->
        <!-- <weld body1="foot" body2="platform" torquescale="1000"/> -->
    </equality>

    <actuator>
        <position name="knee_actuator" kp="10000" kv="200" joint="knee_angle"/>
        <position name="clutch_spring" joint="shank_band_knee" kp="144.5"/>
    </actuator>
    <!-- 59.604965380516845	89.692223816246951	1.445135624936535e+02	1.958747359748776e+02	2.831155274990882e+02	3.518861634135672e+02 -->

    <sensor>
        <torque name="knee_moment" site="knee_sensor"/>
        <jointvel name="knee_joint_vel" joint="knee_angle"/>
    </sensor>

    <worldbody>
        <camera name="fixed_cam" mode="fixed" pos="0.855 1.171 0.570" xyaxes="-0.805 0.593 -0.000 -0.135 -0.183 0.974"/>
        <camera name="front_cam" mode="fixed" pos="0.628 -0.961 0.780" xyaxes="0.866 0.500 0.000 -0.171 0.296 0.940"/>
        <camera name="side_cam" mode="fixed" pos="0.991 0.629 0.640" xyaxes="-0.514 0.858 -0.000 -0.234 -0.140 0.962"/>
        <camera name="rear_cam" mode="fixed" pos="-0.529 0.913 0.698" xyaxes="-0.828 -0.561 0.000 0.204 -0.301 0.932"/>
        <camera name="iso_cam" mode="fixed" pos="-0.066 -0.097 0.523" xyaxes="0.705 -0.709 0.000 0.083 0.083 0.993"/>

        <body name="platform" pos="0 0 0" childclass="bones" mocap="false">
            <joint type="slide" axis="0 0 1" name="platform_slide" range="-2.5 2.5"/>
            <geom mesh="platform" name="platform" type="mesh" mass="0.01" pos="0.03835 0.07698 -0.01" quat="0.707107 0.707107 0 0"/>
        </body>

        <body name="hip_fixture" pos="0 0 0" childclass="bones">
            <inertial pos="0.03835 0.07698 0.67989" mass="0.13071" diaginertia="0.00006778 0.00006167 0.00008403" />
            <geom mesh="hip_fixture" name="hip_fixture" type="mesh" mass="0"/>

            <body name="femur" pos="0.03835 0.07698 0.65793">
                <inertial pos="0.00457 0.01134 -0.14377" mass="0.24064" xyaxes="-0.11102 0.06309 0.99181 -0.33501 0.93720 -0.09711" diaginertia="0.00005 0.00247 0.00248"/>
                <joint axis="0 1 0" name="hip_flexion" pos="0 0 0" range="-0.523599 2.0944"/>
                <geom mesh="femur" name="femur" type="mesh" mass="0"/>

                <body name="thigh" pos="0 0 0" childclass="flexbody">
                    <flexcomp type="gmsh" file="Thigh.msh" rgba=".9 .7 .0 .3" name="thigh" dim="2" radius="0" mass="2.26449451">
                        <contact condim="3" solref="0.01 1" solimp=".95 .99 .0001" selfcollide="none"/>
                        <edge damping="1"/>
                        <elasticity young="1.2e4" poisson="0.475" damping="2.5e-5"/>
                        <pinmesh mesh="femur"/>
                    </flexcomp>
                    <!-- <geom mesh="thigh" name="thigh" type="mesh" mass="2.26449451"/> -->
                </body>

                <body name="thigh_band" pos="0.00526 0 -0.29865" childclass="exosuit">
                    <joint axis="0 1 0" name="thigh_band_knee" pos="0 0 0"/>
                    <geom mesh="thigh_strap" name="thigh_band" type="mesh" pos="0 0 0" mass="0.635" euler="0 0 0"/>

                    <body name="thigh_band_collsion" pos="0 0 0" childclass="exosuit_collision">
                        <!-- <geom mesh="thigh_strap_col" name="thigh_band_col" type="mesh" pos="0 0 0" mass="0.635" euler="0 0 0"/> -->
                        <!-- <geom type="box" mass="0.105" size="0.005 0.02 0.07" pos="-0.059 0 0.11365" euler="0 -0.13 0"/>
                        <geom type="box" mass="0.105" size="0.005 0.02 0.07" pos="-0.050  0.035  0.11365" euler="0 -0.21 -0.6"/>
                        <geom type="box" mass="0.105" size="0.005 0.02 0.07" pos="-0.049  -0.035  0.11365" euler="0 -0.15 0.6"/>

                        <geom type="box" mass="0.105" size="0.005 0.02 0.07" pos="0.065  0  0.11365" euler="0 0.08 -0.1"/>
                        <geom type="box" mass="0.105" size="0.005 0.02 0.07" pos="0.058  0.035  0.11365" euler="0 0.18 0.4"/>
                        <geom type="box" mass="0.105" size="0.005 0.02 0.07" pos="0.046  -0.035  0.11365" euler="0 0.08 -0.7"/> -->
                        <geom type="sdf" name="thigh_band_col" pos="0 0 0" mass="0" mesh="thigh_strap_col_sdf">
                            <plugin instance="sdf_thigh"/>
                        </geom>
                    </body>

                    <body name="shank_band" pos="0 0 0">
                        <joint axis="0 1 0" name="shank_band_knee" pos="0 0 0"/>
                        <geom mesh="shank_strap" name="shank_band" type="mesh" pos="0 0 0" mass="0.388" euler="0 0 0"/>

                        <body name="shank_band_collision" pos="0 0 0" childclass="exosuit_collision">
                            <!-- <geom mesh="shank_strap_col" name="shank_band_col" type="mesh" pos="0 0 0" mass="0.388" euler="0 0 0"/> -->
                            <!-- <geom type="box" mass="0.065" size="0.005 0.02 0.09" pos="-0.058 0 -0.16" euler="0 -0.1 0"/>
                            <geom type="box" mass="0.065" size="0.005 0.02 0.09" pos="-0.050 0.035 -0.16" euler="0 -0.1 -0.6"/>
                            <geom type="box" mass="0.065" size="0.005 0.02 0.09" pos="-0.037 -0.03 -0.16" euler="0 -0.11 0.9"/>

                            <geom type="box" mass="0.065" size="0.005 0.02 0.09" pos="0.0325 0.01 -0.16" euler="0 0.045 0"/>
                            <geom type="box" mass="0.065" size="0.005 0.02 0.09" pos="0.0185 0.04 -0.16" euler="0 0.08 0.8"/>
                            <geom type="box" mass="0.065" size="0.005 0.02 0.09" pos="0.025 -0.02 -0.16" euler="0 0.055 -0.8"/> -->
                            <geom type="sdf" name="shank_band_col" pos="0 0 0" mass="0" mesh="shank_strap_col_sdf">
                                <plugin instance="sdf_shank"/>
                            </geom>
                        </body>
                    </body>
                </body>

                <body name="tibia" pos="0.00526 0 -0.29865">
                    <inertial pos="0.00158 0.00259 -0.10784" mass="0.32564" fullinertia="0.00298 0.00298 0.00010 -0.00001 0.00012 -0.00001"/>
                    <joint axis="0 1 0" name="knee_angle" pos="0 0 0" range="0 3.0944"/>
                    <site name="knee_sensor" pos="0 0 0"/>
                    <geom mesh="tibia" name="tibia" type="mesh" mass="0"/>

                    <body name="shank" pos="0 0 0" childclass="flexbody">
                        <flexcomp type="gmsh" file="Shank.msh" rgba=".9 .7 .0 .3" name="l_shank" dim="2" radius="0" mass="0.90204033">
                            <contact condim="3" solref="0.01 1" solimp=".95 .99 .0001" selfcollide="none"/>
                            <edge damping="1"/>
                            <elasticity young="1.2e4" poisson="0.475" damping="2.5e-5"/>
                            <pinmesh mesh="tibia"/>
                        </flexcomp>
                        <!-- <geom mesh="shank" name="shank" type="mesh" mass="0.90204033"/> -->
                    </body>

                    <body name="foot" pos="-0.00526 0 -0.30429">
                        <inertial pos="0 0 -0.03696" mass="0.31095" fullinertia="0.00047 0.00046 0.00078 0 0 0"/>
                        <joint axis="0 1 0" name="ankle_angle" pos="0 0 0" range="-0.9 0.9"/>
                        <geom mesh="foot" name="foot" type="mesh" mass="0"/>
                    </body>
                </body>
            </body>
        </body>
    </worldbody>
</mujoco>

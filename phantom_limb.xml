<mujoco model="phantom_limb">
    <option timestep=".001"/>

    <compiler angle="radian" strippath="true" meshdir="meshes/"/>

    <extension>
        <plugin plugin="mujoco.elasticity.solid"/>
    </extension>

    <asset>
        <material name="mat_bones" rgba="1 1 1 1"/>

        <mesh file="r_pelvis.stl" name="r_pelvis"/>
        <mesh file="l_pelvis.stl" name="l_pelvis"/>
        <mesh file="sacrum.stl" name="sacrum"/>
        <mesh file="l_femur.stl" name="l_femur"/>
        <mesh file="l_tibia.stl" name="l_tibia"/>
        <mesh file="l_fibula.stl" name="l_fibula"/>
        <mesh file="l_talus.stl" name="l_talus"/>
        <mesh file="l_foot.stl" name="l_foot"/>
        <mesh file="l_bofoot.stl" name="l_bofoot"/>
        <mesh file="l_patella.stl" name="l_patella"/>
    </asset>

    <default>
        <default class="bones">
            <joint armature="0.01" damping="0.5" limited="true"/>
            <geom margin="0.001" material="mat_bones" conaffinity="0" contype="0"/>
        </default>
        <default class="flexbody">
            <joint armature="0" damping="0" limited="false"/>
        </default>
    </default>

    <actuator>
        <position name="platform_act" kp="10000" kv="1000" joint="platform_slide" ctrllimited="true" ctrlrange="0.0175 0.215"/>
    </actuator>

    <equality>
        <weld body1="calcn_l" body2="platform"/>
    </equality>

    <sensor>
        <force name="ankle_force" site="ankle_sensor"/>
    </sensor>

    <worldbody>
        <body name="platform" pos="0 0 0.04" childclass="bones">
            <joint type="slide" axis="0 0 1" name="platform_slide" range="-0.5 0.5"/>
            <geom name="platform" type="box" size="0.3 0.3 0.01" mass="1"/>
        </body>

        <body name="pelvis" pos="0 0 1" quat="0.707107 0.707107 0 0" childclass="bones">
            <inertial pos="-0.07 -0.03 0" mass="10.96" diaginertia="0.0622075 0.0532711 0.0299242" />
            <geom mesh="l_pelvis" name="l_pelvis" type="mesh"/>

            <body name="femur_l" pos="-0.056276 -0.07849 -0.07726">
                <inertial pos="0 -0.195 0.0005" quat="0.7062 -0.708013 0 0" mass="0.3" diaginertia="0.1694 0.1694 0.0245269" />
                <joint axis="0 0 1" name="hip_flexion_l" pos="0 0 0" range="-0.523599 2.0944"/>
                <joint axis="-1 0 0" name="hip_adduction_l" pos="0 0 0" range="-0.872665 0.523599"/>
                <joint axis="0 -1 0" name="hip_rotation_l" pos="0 0 0" range="-0.698132 0.698132"/>
                <geom mesh="l_femur" name="l_femur" type="mesh"/>

                <body name="thigh_l" pos="0 -0.2 0" childclass="flexbody">
                    <flexcomp type="gmsh" file="test_thigh.msh" pos="-0.1 -0.25 -0.1" scale="0.8 0.8 0.8" radius="0.001" rgba=".9 .7 .0 .5" name="ball" dim="2" mass="8.1">
                        <contact condim="3" solref="0.01 1" solimp=".95 .99 .0001" selfcollide="none"/>
                        <edge damping="1"/>
                        <plugin plugin="mujoco.elasticity.solid">
                            <config key="poisson" value="0.25"/>
                            <config key="young" value="5e4"/>
                        </plugin>
                        <pin id="194"/>
                        <pin id="232"/>
                        <pin id="199"/>
                        <pin id="256"/>
                        <pin id="204"/>
                    </flexcomp>
                </body>

                <body name="tibia_l" pos="-4.6e-07 -0.404425 0.00126526">
                    <inertial pos="-0.005 -0.175 -0.0025" quat="0.712137 -0.701754 0.0200501 0" mass="3.8" diaginertia="0.0771589 0.0771589 0.00690387" />
                    <joint axis="-0.992246 -0.123982 -0.00878916" name="knee_angle_l_translation2" pos="0 0 0" range="-0.006792 -7.69254e-11" type="slide"/>
                    <joint axis="-0.124293 0.989762 0.0701648" name="knee_angle_l_translation1" pos="0 0 0" range="9.53733e-08 0.00159883" type="slide"/>
                    <!-- <joint axis="3.98373e-10 0.0707131 -0.997497" name="knee_angle_l" pos="0 0 0" range="0 2.0944"/> -->
                    <joint axis="3.98373e-10 0.0707131 -0.997497" name="knee_angle_l" pos="0 0 0" range="0 2.0944"/>
                    <joint axis="-0.992246 -0.123982 -0.00878916" name="knee_angle_l_rotation2" pos="0 0 0" range="-0.00167821 0.0335354"/>
                    <joint axis="-0.124293 0.989762 0.0701648" name="knee_angle_l_rotation3" pos="0 0 0" range="-0.262788 -1.08939e-08"/>
                    <geom mesh="l_tibia" name="l_tibia" type="mesh"/>
                    <geom mesh="l_fibula" name="l_fibula" type="mesh"/>

                    <body name="talus_l" pos="-0.01 -0.4 0">
                        <!-- <joint axis="0.105014 0.174022 0.979126" name="ankle_angle_l" pos="0 0 0" range="-0.698132 0.523599"/> -->
                        <joint axis="0.105014 0.174022 0.979126" name="ankle_angle_l" pos="0 0 0" range="-0.698132 0.523599"/>
                        <geom mesh="l_talus" name="l_talus" type="mesh"/>
                        <site name="ankle_sensor" pos="0 0 0"/>

                        <body name="calcn_l" pos="-0.04877 -0.04195 -0.00792">
                            <inertial pos="0.0821377 0.0108024 0.000944392" quat="0.541341 0.502987 0.458598 0.493601" mass="1.14" diaginertia="0.00313636 0.00297113 0.000941737" />
                            <joint axis="-0.78718 -0.604747 -0.120949" name="subtalar_angle_l" pos="0 0 0" range="-0.349066 0.349066"/>
                            <geom mesh="l_foot" name="l_foot" type="mesh"/>

                            <body name="toes_l" pos="0.1788 -0.002 -0.00108">
                                <joint axis="-0.580954 0 -0.813936" name="mtp_angle_l" pos="0 0 0" range="-0.523599 0.523599"/>
                                <geom mesh="l_bofoot" name="l_bofoot" type="mesh"/>
                            </body>
                        </body>
                    </body>
                </body>
            </body>
        </body>

        <geom name="ground" type="plane" pos="0 0 0" size="5 5 0.1" rgba="0.8 0.8 0.8 1"/>
    </worldbody>
</mujoco>